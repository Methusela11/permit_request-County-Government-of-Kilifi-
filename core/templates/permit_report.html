{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>County Government of Kilifi - Noise Permit</title>
  <meta name="description" content="Noise Permit Application for Kilifi County">
  <meta name="keywords" content="Kilifi, Noise, Permit, Environment, Government">

  <!-- Favicons -->
  <link href="{% static 'assets/img/logo/CGK11.png' %}" rel="icon">
  <link href="{% static 'assets/img/logo/CGK11.png' %}" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!-- Vendor CSS -->
  <link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static 'assets/css/main.css' %}" rel="stylesheet">
  <link href="{% static 'assets/css/permitform.css' %}" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    table th, table td {
        font-size: 14px;
        padding: 6px 10px;
    }
    th { width: auto; }
    .print-btn {
        float: right;
        margin-top: 5px;
    }
  </style>

     <style>
    .branding {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1030;
      background: #ccc;
      transition: background 0.3s ease, box-shadow 0.3s ease;
      backdrop-filter: blur(6px);
      padding: 10px 0;
    }

    .nav-link,
    .nav-link:focus {
      color: black !important;
    }

    .nav-link:hover {
      color: #0dcaf0;
    }

    @media (max-width: 767.98px) {
  .branding .container {
    flex-direction: row !important;
    align-items: center !important;
    justify-content: space-between !important;
  }

  .branding a.d-flex {
    flex-direction: row !important;
    align-items: center !important;
    gap: 8px;
  }

  .branding img {
    max-height: 55px;
    height: auto;
  }

  .branding small {
    font-size: 12px;
    line-height: 1.6;
    color: black;
  }

  .btn {
    font-size: 12px;
    padding: 6px 6px;
  }
        #mobile-menu a {
  border-bottom: 1px solid #ddd;
}

#mobile-menu {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: #f8f9fa;
  z-index: 1029;
  transition: all 0.3s ease;
}

  .mobile-nav-toggle {
    font-size: 24px;
    color: #000;
    margin-left: 10px;
  }

}
  </style>
</head>

<body class="index-page">

<header class="header sticky-top">

  <div id="branding" class="branding">

    <div class="container d-flex justify-content-between align-items-center py-3">
        <!-- Logo and Site Name -->
        <a href="{% url 'home' %}" class="d-flex align-items-center text-white text-decoration-none gap-1">
            <img src="{% static 'assets/img/logo/CGK11.png' %}" alt="Kilifi Logo" height="60" style="margin-right: 4px">
            <div class="d-flex flex-column lh-sm text-black">
                <small class="mb-0"><b>Permit Request</b></small>
                <small class="mb-0"><b>System</b></small>
            </div>
        </a>

      <!-- Nav and CTA Button Wrapper -->
      <div class="d-flex align-items-center ms-auto">
        <!-- Desktop Navigation -->
        <nav id="navmenu" class="navmenu d-none d-xl-block">
          <ul class="nav">
            <li class="nav-item"><a href="{% url 'home' %}" class="nav-link">Home</a></li>
            <li class="nav-item"><a href="{% url 'readmore' %}" class="nav-link">About</a></li>
            <li class="nav-item"><a href="{% url 'contact' %}" class="nav-link">Contact Us</a></li>
            {% if request.user.is_staff %}
              <li class="nav-item"><a href="{% url 'clients' %}" class="nav-link">Clients</a></li>
            {% endif %}
            {% if user.is_authenticated %}
                <li class="nav-item"><a href="{% url 'logout' %}" class="nav-link">Logout</a></li>
            {% else %}
                <li class="nav-item"><a href="{% url 'login' %}" class="nav-link">Login</a></li>
            {% endif %}
          </ul>
        </nav>
      <!-- Mobile Navigation Menu -->
        <div id="mobile-menu" class="d-xl-none d-none flex-column bg-light px-3 py-3 text-black">
            <a href="{% url 'home' %}" class="nav-link text-dark py-2">Home</a>
            <a href="{% url 'readmore' %}" class="nav-link text-dark py-2">About</a>
            <a href="{% url 'contact' %}" class="nav-link text-dark py-2">Contact Us</a>
            {% if request.user.is_staff %}
                <a href="{% url 'clients' %}" class="nav-link text-dark py-2">Clients</a>
            {% endif %}
            {% if user.is_authenticated %}
                <a href="{% url 'logout' %}" class="btn btn-danger mt-2">Logout</a>
            {% else %}
                <a href="{% url 'login' %}" class="btn btn-success mt-2">Login</a>
            {% endif %}

        </div>
      </div>
      <!-- Mobile Nav Toggle -->
      <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
    </div>
  </div>
</header>

<main class="main">
    <br>
    <br>
    <br>
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center">
        <h2>Permit Reports</h2>
        <button class="btn btn-secondary print-btn" onclick="printReport()">üñ®Ô∏è Print Report</button>
    </div>

    <form method="get" class="mb-4">
        <div class="row">
            <div class="col-md-3">
                <label>Subcounty</label>
                <input type="text" name="subcounty" class="form-control" placeholder="Enter subcounty" value="{{ request.GET.subcounty }}">
            </div>
            <div class="col-md-3">
                <label>Status</label>
                <select name="status" class="form-control">
                    <option value="">--All--</option>
                    <option value="approved" {% if request.GET.status == 'approved' %}selected{% endif %}>Approved</option>
                    <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>Pending</option>
                </select>
            </div>
            <div class="col-md-3">
                <label>Date From</label>
                <input type="date" name="start_date" class="form-control" value="{{ request.GET.start_date }}">
            </div>
            <div class="col-md-3">
                <label>Date To</label>
                <input type="date" name="end_date" class="form-control" value="{{ request.GET.end_date }}">
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-3 align-self-end">
                <button class="btn btn-primary mt-2">Filter</button>
            </div>
        </div>
    </form>

    <div id="report-content">
        <table class="table table-bordered table-striped">
            <thead class="table-light">
                <tr>
                    <th style="width: 15%;">Full Name</th>
                    <th style="width: 10%;">ID</th>
                    <th style="width: 12%;">Phone</th>
                    <th style="width: 12%;">Subcounty</th>
                    <th style="width: 10%;">Ward</th>
                    <th style="width: 15%;">Purpose</th>
                    <th style="width: 10%;">Date</th>
                    <th style="width: 10%;">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for permit in permits %}
                <tr>
                    <td>{{ permit.full_name }}</td>
                    <td>{{ permit.id_number }}</td>
                    <td>{{ permit.phone }}</td>
                    <td>{{ permit.subcounty }}</td>
                    <td>{{ permit.ward }}</td>
                    <td>{{ permit.purpose }}</td>
                    <td>{{ permit.date }}</td>
                    <td>
                        {% if permit.approved %}
                            <span class="badge bg-success">Approved</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">Pending</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center">No permits found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
        <div class="text-center">
            <a href="{% url 'readmore' %}">
            <small style="font-size: 0.80rem;" class="text-black">
                ¬© 2026 Permit Request System - County Government of Kilifi
                <br> All Rights Reserved
            </small>
            </a>
        </div>
</main>

<script>
function printReport() {
    var content = document.getElementById("report-content").innerHTML;
    var printWindow = window.open("", "", "width=1000,height=700");
    printWindow.document.write(`
        <html>
            <head>
                <title>Permit Report</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    table { width: 100%; border-collapse: collapse; }
                    th, td { border: 1px solid #333; padding: 8px; text-align: left; }
                    th { background-color: #f2f2f2; }
                    h2 { text-align: center; }
                </style>
            </head>
            <body>
                <h2>Permit Report</h2>
                ${content}
            </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
    printWindow.close();
}
</script>
  <!-- Preloader -->
  <div id="preloader"></div>
<script>
  window.addEventListener('load', function () {
    var preloader = document.getElementById('preloader');
    if (preloader) {
      preloader.style.display = 'none';
    }
  });
</script>

  <!-- Vendor JS Files -->
  <script src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'assets/vendor/php-email-form/validate.js' %}"></script>
  <script src="{% static 'assets/vendor/aos/aos.js' %}"></script>
  <script src="{% static 'assets/vendor/glightbox/js/glightbox.min.js' %}"></script>
  <script src="{% static 'assets/vendor/purecounter/purecounter_vanilla.js' %}"></script>
  <script src="{% static 'assets/vendor/swiper/swiper-bundle.min.js' %}"></script>

  <!-- Main JS File -->
  <script src="{% static 'assets/js/main.js' %}"></script>

<!-- Mobile Nav Toggle Script -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.querySelector('.mobile-nav-toggle');
    const mobileMenu = document.getElementById('mobile-menu');

    toggle.addEventListener('click', () => {
      mobileMenu.classList.toggle('d-none');
      toggle.classList.toggle('bi-list');
      toggle.classList.toggle('bi-x');
    });
  });
</script>

</body>

</html>
